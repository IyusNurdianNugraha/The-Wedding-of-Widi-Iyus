<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Wedding of Widi & Iyus</title>
  <style>
    :root{--bg:#0f1724;--card:#141c2c;--accent:#f97316;--muted:#cbd5e1;--glass: rgba(255,255,255,0.05);--green:#16a34a;--red:#dc2626}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#f1f5f9;background:linear-gradient(180deg,#0b1220 0%, #0f1724 100%);-webkit-font-smoothing:antialiased;text-align:center}
    .container{max-width:720px;margin:0 auto;padding:16px;width:100%}
    .landing{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(180deg,#0b1220,#0f1724);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:999;transition:opacity 0.6s ease}
    .landing.hide{opacity:0;pointer-events:none}
    .btn-open{background:var(--accent);color:#fff;padding:12px 20px;border-radius:12px;border:none;cursor:pointer;font-size:14px;font-weight:600}
    .card{background:var(--card);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.6);backdrop-filter: blur(6px);margin-bottom:20px}
    header{text-align:center}
    .cover-photo{width:100%;max-height:4300px;overflow:hidden;border-radius:12px;margin-bottom:12px}
    .cover-photo img{width:100%;height:auto;display:block}
    .cover{border-radius:12px;overflow:hidden;min-height:220px;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:16px;background:rgba(0,0,0,0.25);margin:16px 0}
    .countdown{margin-top:16px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    .cd-box{background:rgba(0,0,0,0.5);padding:12px 16px;border-radius:10px;min-width:70px;opacity:0;transform:scale(.95);transition:all .35s ease}
    .cd-box.visible{opacity:1;transform:scale(1)}
    .cd-box span{display:block;font-size:20px;font-weight:700;color:#fff}
    .cd-label{font-size:12px;color:var(--muted)}
    .details{padding:16px;border-radius:12px;background:var(--glass)}
    .detail-row{padding:14px 0;border-bottom:1px dashed rgba(255,255,255,0.08)}
    .detail-row:last-child{border-bottom:0}
    .muted{color:var(--muted);font-size:15px;margin-bottom:4px}
    .date{font-size:16px;font-weight:600}
    .actions{margin-top:12px;text-align:center}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600;font-size:13px;text-decoration:none;display:inline-block;transition:0.25s}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.08)}
    .btn-green{background:var(--green);color:#fff}
    .btn-red{background:var(--red);color:#fff}
    iframe{width:100%;border:0;border-radius:12px;margin-top:16px;min-height:260px}
    .bank-row{display:flex;flex-direction:column;align-items:center;gap:6px}
    .bank-acc{margin-top:6px;display:flex;align-items:center;gap:8px}
    .copy-icon{width:18px;height:18px;cursor:pointer;opacity:0.9}
    .copy-feedback{font-size:13px;color:var(--muted);margin-top:8px}
    .qris-img{width:220px;height:220px;object-fit:cover;border-radius:12px;display:block;margin:0 auto}
    .attendance{display:flex;gap:10px;margin-top:6px}
    .attendance button{flex:1}
    .rsvp-list{margin-top:16px;text-align:left}
    .rsvp-item{padding:10px;border-bottom:1px solid rgba(255,255,255,0.05)}
    .rsvp-item strong{color:#fff}
    .rsvp-time{font-size:12px;color:var(--muted);margin-top:6px}
    .filter-btns{display:flex;gap:8px;margin-top:12px;justify-content:center}
    .rsvp-count{margin-top:10px;font-size:13px;color:var(--muted);text-align:center}
    textarea,input{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);color:#fff}
    label{font-size:14px;display:block;margin-top:10px;text-align:left}
    footer{margin-top:18px;color:var(--muted);font-size:12px;text-align:center}
    .fade-in-up{animation:fadeInUp .9s ease both}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
    .slide-down{animation:slideDown .9s ease both}
    @keyframes slideDown{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:translateY(0)}}
    @media(min-width:900px){.container{max-width:900px}}
  </style>
</head>
<body>
  <div class="landing" id="landing">
    <h1 class="fade-in-up">Undangan Pernikahan</h1>
    <h2 class="fade-in-up">Widi & Iyus</h2>
    <p id="invitee" class="fade-in-up">Kepada Yth.<br/>Tamu Undangan</p>
    <button class="btn-open" id="openBtn" type="button">Buka Undangan</button>
  </div>

  <div class="container" id="mainContent" style="display:none">
    <div class="card">
      <header>
        <div class="logo"></div>
        <div class="cover-photo slide-down">
          <img src="528769997_1503030160704915_415698313518985546_n.jpg" alt="Foto Widi & Iyus">
        </div>
        <h1 class="fade-in-up">The Wedding of</h1>
        <h2 class="sub-title fade-in-up">Widi & Iyus</h2>
        <p class="lead fade-in-up">Dengan penuh sukacita, kami mengundang Anda untuk menghadiri hari bahagia kami.</p>

        <div class="cover fade-in-up">
          <h2 id="event-title">Save the Date</h2>
          <p id="event-sub">Minggu, 21 September 2025</p>
          <div class="countdown" id="countdown">
            <div class="cd-box" id="cdDays"><span id="days">0</span><div class="cd-label">Hari</div></div>
            <div class="cd-box" id="cdHours"><span id="hours">0</span><div class="cd-label">Jam</div></div>
            <div class="cd-box" id="cdMinutes"><span id="minutes">0</span><div class="cd-label">Menit</div></div>
            <div class="cd-box" id="cdSeconds"><span id="seconds">0</span><div class="cd-label">Detik</div></div>
          </div>
        </div>
      </header>
    </div>

    <div class="card details fade-in-up">
      <div class="detail-row">
        <div class="muted">Maha suci Allah yang telah menciptakan makhluk berpasang-pasangan, semoga ridho-Mu tercurah mengiringi pernikahan kami:</div>
      </div>
      <div class="detail-row">
        <div class="muted">Mempelai Wanita</div>
        <div class="date">Widi Susan Sandofa<br/>Putri dari Bapak Ujang Rohana & Ibu Siti Nurfatimah<br/>(Kab. Bandung)</div>
      </div>
      <div class="detail-row">
        <div class="muted">Dengan</div>
        <div class="date">Iyus Nurdian Nugraha<br/>Putra dari Bapak Agus Sugiana (Alm) & Ibu Solihat<br/>(Kab. Garut)</div>
      </div>
      <div class="detail-row">
        <div class="muted">Tanggal & Waktu</div>
        <div class="date">Minggu, 21 September 2025<br/>Akad Nikah: 09.00 WIB s/d Selesai<br/>Resepsi: 11.00 WIB s/d Selesai</div>
        <div class="actions">
          <a href="#" id="addCal" class="btn btn-primary">Simpan ke Google Calendar</a>
        </div>
      </div>

      <div class="detail-row">
        <div class="muted">Alamat Acara</div>
        <div class="date">Kp. Cigebar RT 07 RW 18 Desa Bojongsari<br/>Kec. Bojongsoang Kab. Bandung</div>
      </div>

      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3954.683987167812!2d107.660000!3d-7.024000!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e68e9f8f87a5e41%3A0x123456789abcdef!2sBojongsari%2C%20Bojongsoang%2C%20Bandung!5e0!3m2!1sid!2sid!4v1693840000000!5m2!1sid!2sid" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

      <div class="actions">
        <a href="https://maps.app.goo.gl/8cRBcLWJJDriVWQu5" target="_blank" class="btn btn-primary">Lihat di Google Maps</a>
      </div>
    </div>

    <div class="card gift fade-in-up">
      <h3 style="margin:0 0 12px 0;text-align:center">Kirim Hadiah</h3>
      <p class="muted" style="text-align:center">Bagi keluarga dan sahabat yang ingin berbagi kebahagiaan, dapat mengirim hadiah melalui:</p>
      <div class="bank-row" style="margin:12px 0;font-size:15px">
        <div style="text-align:center">
          <div style="font-weight:700">Widi Susan Sandofa</div>
          <div class="bank-acc">BCA — 3370895731 <img src="https://img.icons8.com/material-outlined/24/ffffff/copy.png" id="copyAcc" class="copy-icon" title="Salin nomor rekening"/></div>
        </div>
      </div>

      <div style="margin:20px 0;font-size:15px;text-align:center">
        <div style="font-weight:700">Iyus Nurdian Nugraha</div>
        <div style="margin-top:6px">Silakan scan QRIS di bawah ini:</div>
      </div>
      <div style="margin-top:10px;text-align:center">
        <a href="qrisiyus.jpeg" download>
          <img src="qrisiyus.jpeg" alt="QRIS Iyus" class="qris-img" />
        </a>
        <div id="copyFeedback" class="copy-feedback" aria-live="polite"></div>
      </div>
    </div>

    <div class="card rsvp fade-in-up">
      <h3 style="margin:0 0 8px 0;text-align:center">Konfirmasi Kehadiran</h3>
      <p class="muted" style="text-align:center">Pilih status kehadiran Anda, lalu tuliskan ucapan.</p>

      <label for="attendance">Kehadiran</label>
      <div class="attendance">
        <button type="button" class="btn btn-ghost" id="btnHadir">Hadir</button>
        <button type="button" class="btn btn-ghost" id="btnTidakHadir">Tidak Hadir</button>
      </div>
      <input type="hidden" id="attendance" value="" />

      <label for="name">Nama</label>
      <input type="text" id="name" placeholder="Nama lengkap" />

      <label for="message">Ucapan</label>
      <textarea id="message" placeholder="Tulis ucapan untuk mempelai..."></textarea>

      <div style="display:flex;gap:8px;margin-top:12px;justify-content:center">
        <button class="btn btn-primary" id="sendRsvp">Kirim</button>
        <button class="btn btn-ghost" id="clearForm">Bersihkan</button>
      </div>

      <div id="rsvpMsg" style="margin-top:10px;color:var(--muted);font-size:13px;text-align:center"></div>

      <div class="filter-btns">
        <button class="btn btn-ghost" id="filterAll">Semua</button>
        <button class="btn btn-green" id="filterHadir">Hadir</button>
        <button class="btn btn-red" id="filterTidakHadir">Tidak Hadir</button>
      </div>

      <div class="rsvp-count" id="rsvpCount"></div>

      <div class="rsvp-list" id="rsvpList"></div>
    </div>

    <footer>
      © <span id="year"></span> Widi & Iyus • Dengan cinta.
    </footer>
  </div>

  <audio id="bgAudio" src="music.mp3" loop></audio>

  <script>
    // --- helper: read invite parameter (supports raw rest after ?to=...) ---
    function readInvite(){
      const params = new URLSearchParams(window.location.search);
      let invitee = params.get('to');
      if(!invitee){
        const m = window.location.href.match(/[?&]to=(.*)$/);
        if(m && m[1]) invitee = decodeURIComponent(m[1].replace(/\+/g,' '));
      }
      return invitee;
    }

    const invitee = readInvite();
    if(invitee){
      document.getElementById('invitee').innerHTML = `Kepada Yth.<br/>${invitee}`;
    }

    // Landing -> open
    const landing = document.getElementById('landing');
    const mainContent = document.getElementById('mainContent');
    const openBtn = document.getElementById('openBtn');
    const bgAudio = document.getElementById('bgAudio');

    function fadeAudioIn(){
      let vol = 0;
      bgAudio.volume = 0;
      const it = setInterval(()=>{
        vol = Math.min(vol + 0.05, 0.6);
        bgAudio.volume = vol;
        if(vol >= 0.6) clearInterval(it);
      },200);
    }

    function unlockAndPlayAudio(){
      bgAudio.play().then(()=>{
        fadeAudioIn();
      }).catch(()=>{
        // some browsers block autoplay, user interaction required
      });
    }

    openBtn.addEventListener('click', ()=>{
      // hide landing with transition
      landing.classList.add('hide');
      unlockAndPlayAudio();
      setTimeout(()=>{
        landing.style.display = 'none';
        mainContent.style.display = 'block';
        // reveal countdown boxes
        document.querySelectorAll('.cd-box').forEach((el,i)=> setTimeout(()=>el.classList.add('visible'), i*120));
      },700);
    });

    // also try to play on first user gesture
    document.addEventListener('click', unlockAndPlayAudio, {once:true});
    document.addEventListener('scroll', unlockAndPlayAudio, {once:true});

    // Countdown to akad 09:00 WIB -> 2025-09-21T02:00:00Z
    const targetDate = new Date('2025-09-21T02:00:00Z').getTime();
    function updateCountdown(){
      const now = Date.now();
      const dist = targetDate - now;
      if(dist <= 0){
        document.getElementById('countdown').innerHTML = '<p>Hari ini waktunya akad! 💍</p>';
        return;
      }
      const days = Math.floor(dist / (1000*60*60*24));
      const hours = Math.floor((dist % (1000*60*60*24)) / (1000*60*60));
      const minutes = Math.floor((dist % (1000*60*60)) / (1000*60));
      const seconds = Math.floor((dist % (1000*60)) / 1000);
      document.getElementById('days').textContent = days;
      document.getElementById('hours').textContent = hours;
      document.getElementById('minutes').textContent = minutes;
      document.getElementById('seconds').textContent = seconds;
    }
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // RSVP + attendance logic with timestamps
    const btnHadir = document.getElementById('btnHadir');
    const btnTidakHadir = document.getElementById('btnTidakHadir');
    const attendanceInput = document.getElementById('attendance');
    const sendRsvp = document.getElementById('sendRsvp');
    const clearForm = document.getElementById('clearForm');
    const rsvpMsg = document.getElementById('rsvpMsg');
    const rsvpList = document.getElementById('rsvpList');
    const rsvpCount = document.getElementById('rsvpCount');

    function setAttendance(status){
      attendanceInput.value = status;
      if(status === 'Hadir'){
        btnHadir.classList.add('btn-green');
        btnHadir.classList.remove('btn-ghost');
        btnTidakHadir.classList.remove('btn-red');
        btnTidakHadir.classList.add('btn-ghost');
      }else if(status === 'Tidak Hadir'){
        btnTidakHadir.classList.add('btn-red');
        btnTidakHadir.classList.remove('btn-ghost');
        btnHadir.classList.remove('btn-green');
        btnHadir.classList.add('btn-ghost');
      }
    }

    btnHadir.addEventListener('click', ()=> setAttendance('Hadir'));
    btnTidakHadir.addEventListener('click', ()=> setAttendance('Tidak Hadir'));

    // load saved
    rsvps = JSON.parse(localStorage.getItem('rsvps') || '[]');

    function addRsvpToList(item){
      const div = document.createElement('div');
      div.className = 'rsvp-item';
      div.setAttribute('data-attendance', item.attendance || '');
      const icon = (item.attendance === 'Hadir') ? '✅' : (item.attendance === 'Tidak Hadir') ? '❌' : '';
      const time = item.time || '';
      div.innerHTML = `<strong>${escapeHtml(item.name)}</strong> <span style="font-size:13px;color:${item.attendance==='Hadir'?'var(--green)':'var(--red)'}">${icon} ${item.attendance ? '('+item.attendance+')':''}</span><p>${escapeHtml(item.msg)}</p><div class="rsvp-time">${time}</div>`;
      rsvpList.appendChild(div);
    }

    function updateCount(){
      const hadir = rsvps.filter(i=>i.attendance==='Hadir').length;
      const tidak = rsvps.filter(i=>i.attendance==='Tidak Hadir').length;
      rsvpCount.textContent = `Total Hadir: ${hadir} | Tidak Hadir: ${tidak}`;
    }

    function escapeHtml(text){
      if(!text) return '';
      return text.replace(/[&<>"']/g, function(m){return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[m];});
    }

    // initial render
    rsvps.forEach(item => addRsvpToList(item));
    updateCount();

    sendRsvp.addEventListener('click', ()=>{
      const name = document.getElementById('name').value.trim();
      const msg = document.getElementById('message').value.trim();
      const attendance = attendanceInput.value;
      if(!name || !msg || !attendance){ rsvpMsg.textContent = 'Mohon pilih kehadiran, isi nama dan ucapan.'; return; }
      const time = new Date().toLocaleString('id-ID');
      const data = {name:name, msg:msg, attendance:attendance, time:time};
      rsvps.push(data);
      localStorage.setItem('rsvps', JSON.stringify(rsvps));
      addRsvpToList(data);
      updateCount();
      document.getElementById('name').value = '';
      document.getElementById('message').value = '';
      attendanceInput.value = '';
      btnHadir.classList.remove('btn-green');
      btnTidakHadir.classList.remove('btn-red');
      btnHadir.classList.add('btn-ghost');
      btnTidakHadir.classList.add('btn-ghost');
      rsvpMsg.textContent = 'Ucapan berhasil ditambahkan!';
      setTimeout(()=> rsvpMsg.textContent = '', 1800);
    });

    clearForm.addEventListener('click', ()=>{
      document.getElementById('name').value = '';
      document.getElementById('message').value = '';
      attendanceInput.value = '';
      btnHadir.classList.remove('btn-green');
      btnTidakHadir.classList.remove('btn-red');
      btnHadir.classList.add('btn-ghost');
      btnTidakHadir.classList.add('btn-ghost');
      rsvpMsg.textContent = 'Form dibersihkan.';
      setTimeout(()=> rsvpMsg.textContent = '', 1200);
    });

    // Filters
    document.getElementById('filterAll').addEventListener('click', ()=>{ [...rsvpList.children].forEach(i=> i.style.display='block'); });
    document.getElementById('filterHadir').addEventListener('click', ()=>{ [...rsvpList.children].forEach(i=> i.style.display = i.getAttribute('data-attendance')==='Hadir' ? 'block' : 'none'); });
    document.getElementById('filterTidakHadir').addEventListener('click', ()=>{ [...rsvpList.children].forEach(i=> i.style.display = i.getAttribute('data-attendance')==='Tidak Hadir' ? 'block' : 'none'); });

    // Copy account
    document.getElementById('copyAcc').addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText('3370895731');
        document.getElementById('copyFeedback').textContent = 'Nomor rekening tersalin!';
        setTimeout(()=> document.getElementById('copyFeedback').textContent = '', 1600);
      }catch(e){
        alert('Gagal menyalin. Silakan salin secara manual: 3370895731');
      }
    });

    // Google Calendar
    document.getElementById('addCal').addEventListener('click', (e)=>{
      e.preventDefault();
      const title = encodeURIComponent('The Wedding of Widi & Iyus');
      const details = encodeURIComponent('Akad: 09.00 WIB, Resepsi: 11.00 WIB - Pernikahan Widi & Iyus');
      const location = encodeURIComponent('Kp. Cigebar RT 07 RW 18 Desa Bojongsari, Kec. Bojongsoang Kab. Bandung');
      const start = '20250921T020000Z';
      const end = '20250921T060000Z';
      const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${start}/${end}&details=${details}&location=${location}&sf=true&output=xml`;
      window.open(url, '_blank');
    });

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>